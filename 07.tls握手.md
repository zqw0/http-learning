## https的安全握手
&emsp;&#9728;普通的http请求。client传给server一个报文。通讯的主体都被看到，任意一个中间人都可以截取流量并获取。  
&emsp;&#9728;对称加密：产生一个公钥A，加密时用公钥A加密，解密时用公钥A解密。非对称加密：产生一个公钥和一个私钥，加密时用公钥加密，解密时用私钥解密。或者加密时用私钥解密解密时用公钥解密。   
&emsp;&#9728;如何保证主体安全呢？  
方案１：在传输时，用对称加密给报文加密，并把公钥传给server。明显这个方案不行，因为别人也可以用你传的公钥破解主体。  
方案２：在传输时，先让服务器利用非对称加密生成一对公钥和私钥，然后服务器将公钥传给客户端。客户端利用公钥加密然后再传给服务器。最后服务器利用私钥解密。看起来没有什么问题，但是用非对称加密解密报文实在太慢了。  
方案３：在传输时，先让服务器利用非对称加密生成一对公钥和私钥，然后客户端用对称加密生成一个公钥。服务器将公钥传给客户端，客户端用服务器给的公钥，把自己的公钥加密，再用自己的公钥把报文加密。最后传给服务器，服务器用自己的私钥解密传过来的公钥。得到客户端对称加密的公钥。最后解密报文。  
以为很完美了，却还有一个问题。如果有中间的代理。不怀好意，将服务器传给客户端的公钥换掉了。它自己生成了一对公钥和私钥，然后将它自己的公钥传给了客户端。这时候客户端就会出现安全隐患。  
CA安全证书：服务器先利用非对称加密生成一对公钥和私钥，将自己的公钥给CA安全证书，CA安全证书也生成一对公钥和私钥。然后用你的公钥和你的信息做一次MD5的信息摘要，再将这个信息摘要用CA安全证书的私钥加密。然后用这个加密好的信息摘要和服务器的一些信息作为安全证书一起发布给服务器，并且大家都可以通过这个CA安全证书的网站获取这个服务器的公钥。  
tls加密：
```
客户端给服务器发送一个hello。开始tls握手

服务器给客户端发送一个CA安全证书。此证书包含以加密的MD5信息摘要，还有服务器的一些信息，还有服务器的公钥。  

客户端接收到CA安全证书后，开始验证此证书中途是否有人篡改。先去CA安全证书网站中查询到公钥，然后用公钥将已加密的MD5信息摘要解密。然后用CA证书中包含的服务器信息再做一次MD5信息摘要，看能否和已经解密的MD5信息摘要匹配。如果匹配成功。那么客户端再利用对称加密生成一个公钥。利用服务器传给客户端的公钥，将自己用对称加密产生的公钥加密。然后将加密后的公钥传给服务器。

服务器收到客户端加密后的公钥后，用自己的私钥将其解密。最后拿到客户端利用对称加密产生的公钥。之后服务器就可以利用此公钥进行一系列的通信了。
```
